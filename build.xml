<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project name="Vitry" basedir="." default="debug-js">

	<property name="javascriptVersion" value="180"/>
	<property name="src.js"            value="src/js"/>


	<!-- =============================================================== -->
	<target name="clean" description="">
		<delete dir="bin" failonerror="false" />
	</target>
	

	<!-- =============================================================== -->
	<target name="dirs">
		<mkdir dir="bin"/>
	</target>
	
    <!-- =============================================================== -->
    <target name="javadoc" description="Generate API documentation">

        <mkdir dir="doc" />

        <javadoc
            access="protected"
            author="true"
            doctitle="Vitry"
            use="true"
            version="true"
            destdir="doc"

            classpath="../Vitry/bin"
            packagenames="vitry.runtime, vitry.runtime.misc, vitry.runtime.parse"
            sourcepath="src/java">

            <doclet name="com.visural.doclets.markdown.standard.Standard" path="${user.home}/Library/Java/MarkdownDoclet-3.0.jar"/>

            <link href="http://hanshoglund.github.com/StrictJava/doc/api/index.html" />
            <link href="http://java.sun.com/javase/6/docs/api/" />
        </javadoc>
    </target>

	<!-- =============================================================== -->
	<target name="jsc" description="">
		<!-- TODO use some fancy property operation to factor
		out common code -->

		<java fork="true"
		    classpath="lib/js.jar:lib/jline.jar:bin"
		    classname="org.mozilla.javascript.tools.jsc.Main"
		    failonerror="true">
			<arg value="-d"/>
			<arg value="bin"/>
			<arg value="-nosource"/>
			<arg value="-opt"/>
			<arg value="0"/>
			<arg value="-version"/>
			<arg value="${javascriptVersion}"/>
			<arg value="-package"/>
			<arg value="vitry"/>

			<arg value="${src.js}/vitry/core.js"/>
			<arg value="${src.js}/vitry/header.js"/>
			<arg value="${src.js}/vitry/main.js"/>
		</java>
	</target>

	<!-- =============================================================== -->
	<target name="javac" description="">
		<javac srcdir="src" destdir="bin" extdirs="">
			<classpath>
				<pathelement location="lib/js.jar" />
				<pathelement location="lib/jline.jar" />
				<pathelement location="lib/antlr.jar" />
				<pathelement location="lib/asm-3.3.jar" />
				<pathelement location="lib/asm-commons-3.3.jar" />
				<pathelement location="lib/asm-util-3.3.jar" />
			</classpath>
		</javac>
        <javac srcdir="test" destdir="bin" extdirs="">
            <classpath>
                <pathelement location="lib/js.jar" />
                <pathelement location="lib/jline.jar" />
                <pathelement location="lib/antlr.jar" />
                <pathelement location="lib/asm-3.3.jar" />
                <pathelement location="lib/asm-commons-3.3.jar" />
                <pathelement location="lib/asm-util-3.3.jar" />
            </classpath>
        </javac>
	</target>

	<!-- =============================================================== -->
	<target name="jar">
		<jar destfile="vitry.jar" description="">
			<fileset dir="bin">
				<filename name="**/*" />
			</fileset>
		</jar>
	</target>

	<!-- =============================================================== -->
	<target name="debug" depends="clean, dirs, javac, jsc" description="">
	</target>

	<!-- =============================================================== -->
    <target name="debug-js" depends="jsc" description="">
    </target>

	<!-- =============================================================== -->
	<target name="usage" description="">
		<echo>Usage: ant release</echo>
		<echo>       ant debug</echo>
		<echo>       ant -p for help</echo>
	</target>

</project>